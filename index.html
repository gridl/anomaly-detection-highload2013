<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>Applied Statistics for Performance Monitoring</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/core/deck.core.css">
	
	<!-- Extension CSS files go here. Remove or add as needed. -->
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/extensions/status/deck.status.css">
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/extensions/scale/deck.scale.css">

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/themes/style/swiss.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="imakewebthings-deck.js-e42bd0c/themes/transition/fade.css">

    <link rel="stylesheet" href="local.css">
	
	<!-- Required Modernizr file -->
	<script src="imakewebthings-deck.js-e42bd0c/modernizr.custom.js"></script>
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->

<section class="slide">
  <h1>Applied Statistics for Performance Monitoring</h1>
  <div class="footer">&copy; 2013 Anton Lebedevich</div>
</section>

<section class="slide">
  <h2>A Lot of Graphs</h2>
  <img class="graph" src="graph/great-wall.png"/>
</section>

<section class="slide">
  <h2>Contents</h2>
  <ul>
    <li>Real Data and Ideal Models</li>
    <li>Load Testing (Tuning)</li>
    <li>Production Monitoring</li>
    <li>Correlation</li>
    <li>Tools</li>
</section>

<section class="slide">
  <h2>Real Data vs. Ideal Models</h2>
  <ul>
    <li>noise (human actions)</li>
    <li>outliers</li>
    <li>missing data</li>
    <li>different resolutions</li>
    <li>counter update frequencies</li>
    <li>quantization</li>
    <li>not Gaussian and not random walk</li>
    <li>what is normal for the system?</li>
  </ul>
</section>

<section class="slide">
  <h2>Outlier vs. Changepoint</h2>
  <img class="graph" src="graph/mean-shift.png"/>
</section>

<section class="slide">
  <h2>Outlier vs. Changepoint</h2>
  <img class="graph" src="graph/sudden-drop.png"/>
</section>

<section class="slide">
  <h2>Outlier vs. Changepoint</h2>
  <img class="graph" src="graph/bimodal-spike.png"/>
</section>

<section class="slide">
  <h2>Resolution</h2>
  <li>&gt;=5min</li>
  <li>1min</li>
  <li>10s</li>
  <li>&lt;=1s</li>
</section>

<section class="slide">
  <h2>Load Testing (Tuning)</h2>
  <ul>
    <li>goal</li>
    <li>beware of transient response</li>
    <li>find failure</li>
    <li>filter data</li>
    <li>find bottleneck and fix</li>
    <li>rinse and repeat</li>
  </ul>
</section>

<section class="slide">
  <h2>Transient Response</h2>
  <img class="graph" src="graph/request-rate-restart.png"/>
</section>

<section class="slide">
  <h2>Failure on Target Metric</h2>
  <img class="graph" src="graph/connected-clients.png"/>
</section>

<section class="slide">
  <h2>Failure on Target Metric</h2>
  <img class="graph" src="graph/connected-clients-marked.png"/>
</section>

<section class="slide">
  <h2>Failure on Target Metric</h2>
  <img class="graph" src="graph/connected-clients-cut.png"/>
</section>

<section class="slide">
  <h2>Filtration</h2>
  <ul>
    <li>constants</li>
    <li>index of dispersion (sd/mean)</li>
    <li>apply system knowledge
      <ul>
        <li>tasks migrated by scheduler</li>
        <li>dependent (disk used/free)</li>
        <li>interface traffic &lt; 10 packets/s</li>
        <li>load average &lt; 0.5</li>
        <li>&hellip;</li>
      </ul>
    </li>
  </ul>
</section>

<section class="slide">
  <h2>Missing or Constant</h2>
  <img class="graph" src="graph/was-constant.png"/>
</section>

<section class="slide">
  <h2>Changed Mean</h2>
  <img class="graph" src="graph/changed-mean.png"/>
</section>

<section class="slide">
  <h2>Nonlinear</h2>
  <p>ndiffs: diff until kpss says it's stationary</p>
  <img class="graph" src="graph/nonlinear.png"/>
</section>

<section class="slide">
  <h2>Production Classics</h2>
  <ul>
    <li>Control charts
      <ul>
        <li>fixed window moving average (MA)</li>
        <li>exponentially weighted moving average (EWMA)</li>
      </ul>
    </li>
    <li>Holt-Winters</li>
  </ul>
</section>

<section class="slide">
  <h2>Test Subject</h2>
  <img class="graph" src="graph/bimodal-spike.png"/>
</section>

<section class="slide">
  <h2>Test Subject</h2>
  <img class="graph" src="graph/bimodal-spike-zoom.png"/>
</section>

<section class="slide">
  <h2>Test Subject</h2>
  <img class="graph" src="graph/bimodal-spike-histogram.png"/>
</section>

<section class="slide">
  <h2>Moving Average</h2>
  <img class="graph" src="graph/ma-spike.png"/>
</section>

<section class="slide">
  <h2>EWMA</h2>
  <p>exponentially-weighted moving average</p>
  <img class="graph" src="graph/ewma-spike.png"/>
</section>

<section class="slide">
  <h2>Control Charts</h2>
  <ul>
    <li>stationary</li>
    <li>Gaussian/Poisson</li>
    <li>outliers</li>
  </ul>
</section>

<section class="slide">
  <h2>Two Weeks</h2>
  <img class="graph" src="graph/two-weeks.png"/>
</section>

<section class="slide">
  <h2>Holt-Winters</h2>
  <p>triple exponential smoothing</p>
  <ul>
    <li class="list-bad">needs a lot of data</li>
    <li class="list-bad">sensitive to outliers</li>
    <li class="list-bad">can't handle 3 seasons + holidays</li>
    <li class="list-bad">overfitting</li>
  </ul>
</section>

<section class="slide">
  <h2>Time Shifting</h2>
  <img class="graph" src="graph/two-weeks-shifted.png"/>
</section>

<section class="slide">
  <h2>Production Experimental</h2>
  <ul>
    <li>autocorrelation</li>
    <li>non-parametric 2 sample tests</li>
  </ul>
</section>

<section class="slide">
  <h2>Autocorrelation</h2>
  <img class="graph" src="graph/autocorrelation.png"/>
</section>

<section class="slide">
  <h2>Autocorrelation</h2>
  <p>Ljung-Box Test</p>
  <ul>
    <li class="list-good">non-stationary</li>
    <li class="list-good">mean shift</li>
    <li class="list-good">trends</li>
    <li class="list-bad">seasonal</li>
    <li class="list-bad">periodic (cron jobs, sampling)</li>
    <li class="list-bad">aggregated (MA, EWMA)</li>
  </ul>
</section>

<section class="slide">
  <h2>Distribution Change</h2>
  <img class="graph" src="graph/ks-subject.png"/>
</section>

<section class="slide">
  <h2>Distribution Change</h2>
  <img class="graph" src="graph/ks-with-change.png"/>
</section>

<section class="slide">
  <h2>Distribution Change</h2>
  <img class="graph" src="graph/ks-subject-2.png"/>
</section>

<section class="slide">
  <h2>Distribution Change</h2>
  <img class="graph" src="graph/ks-with-change-2.png"/>
</section>

<section class="slide">
  <h2>2-Sample Tests: Good</h2>
  <p>Kolmogorov–Smirnov, Cramér–von Mises</p>
  <ul>
    <li class="list-good">good for request size and latency (unaggregated)</li>
    <li class="list-good">work on periodic data</li>
    <li class="list-good">outlier resistant</li>
    <li class="list-good">good for data exploration</li>
  </ul>
</section>

<section class="slide">
  <h2>2-Sample Tests: Bad</h2>
  <p>Kolmogorov–Smirnov, Cramér–von Mises</p>
  <ul>
    <li class="list-bad">false positives on trends and seasonal changes</li>
    <li class="list-bad">need many unique values</li>
    <li class="list-bad">computational complexity</li>
    <li class="list-bad">bad for alerting</li>
  </ul>
</section>

<section class="slide">
  <h2>Finding Similar Graphs</h2>
  <ul>
    <li>correlation (Pearson, Spearman)</li>
    <li>Euclidean distance</li>
    <li>dynamic time warping (DTW)</li>
    <li>discrete Fourier transform (DFT)</li>
    <li>discrete wavelet transform (DWT)</li>
  </ul>
</section>

<section class="slide">
  <h2>Cluster Centers</h2>
  <img class="graph" src="graph/medoids.png"/>
</section>

<section class="slide">
  <h2>Cluster Members</h2>
  <img class="graph" src="graph/cluster19.png"/>
</section>

<section class="slide">
  <h2>Cluster Members</h2>
  <img class="graph" src="graph/cluster17.png"/>
</section>

<section class="slide">
  <h2>Clustering</h2>
  <ul>
    <li>non-euclidean (ultrametric) space</li>
    <li>many small clusters</li>
    <li>local clustering around events</li>
    <li>false positives
      <ul>
        <li>cron jobs (log rotation)</li>
        <li>human actions (restarts, reconfigurations)</li>
        <li>cache expirations</li>
        <li>&hellip;</li>
      </ul>
    </li>
  </ul>
</section>

<section class="slide">
  <h2>Tools</h2>
  <ul>
    <li>collectd</li>
    <li>statsd</li>
    <li>graphite</li>
    <li>whisper-fetch</li>
    <li>R</li>
  </ul>
</section>

<section class="slide">
  <h2>R</h2>
  <pre><code>add.smooth <- function(m) {
  r <- nrow(m)
  ms <- sapply(m, function(y) {
    ave(coredata(y),
        seq.int(r) %/% max(3, r %/% 150),
        FUN=function(x) {mean(x, na.rm=T)})
  })
  df <- data.frame(index(m)[rep.int(1:r, ncol(m))],
                   factor(rep(1:ncol(m), each = r), levels = 1:ncol(m)),
                   as.vector(coredata(m)),
                   as.vector(coredata(ms)))
  names(df) <- c("Index", "Series", "Value", "Smooth")
  df
}</code></pre>
</section>

<section class="slide">
  <h2>Kale Stack</h2>
  <ul>
    <li><a href="https://github.com/etsy/skyline">github.com/etsy/skyline</a></li>
    <li><a href="https://github.com/etsy/oculus">github.com/etsy/oculus</a></li>
  </ul>
</section>

<section class="slide">
  <h2>Skyline</h2>
  <img src="img/skyline_screenshot.png"/>
  <div class="fine-print">image from <a href="https://github.com/etsy/skyline">github.com/etsy/skyline</a></div>
</section>

<section class="slide">
  <h2>Skyline Internals</h2>
  <ul>
    <li>Horizon agent</li>
    <li>Redis</li>
    <li>Analyzer agent</li>
    <li>Flask (Python) Web App</li>
  </ul>
</section>

<section class="slide">
  <h2>Skyline Algorithms</h2>
  <ul>
    <li>median absolute deviation</li>
    <li>grubbs</li>
    <li>first hour average</li>
    <li>stddev from average</li>
    <li>stddev from moving average</li>
    <li>mean subtraction cumulation</li>
    <li>least squares</li>
    <li>histogram bins</li>
    <li>ks test</li>
    <li>second order anomalies</li>
  </ul>
</section>

<section class="slide">
  <h2>Oculus</h2>
  <img src="img/oculus_results_screenshot.jpeg"/>
  <div class="fine-print">image from <a href="https://github.com/etsy/oculus">github.com/etsy/oculus</a></div>
</section>

<section class="slide">
  <h2>Oculus Internals</h2>
  <ul>
    <li>Skyline Import Script and Cronjob</li>
    <li>Resque workers</li>
    <li>ElasticSearch</li>
    <li>Sinatra (Ruby) Web App</li>
  </ul>
</section>

<section class="slide">
    <h2>Q&amp;A</h2>
    <p>Anton Lebedevich</p>
    <p>mabrek@gmail.com</p>
    <p><a target="_blank" href="https://twitter.com/widdoc">twitter.com/widdoc</a>
    <p><a target="_blank" href="https://github.com/mabrek">github.com/mabrek</a></p>
</section>

<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="imakewebthings-deck.js-e42bd0c/jquery-1.7.2.min.js"></script>
<script src="imakewebthings-deck.js-e42bd0c/core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="imakewebthings-deck.js-e42bd0c/core/deck.core.js"></script>
<script src="imakewebthings-deck.js-e42bd0c/extensions/hash/deck.hash.js"></script>
<script src="imakewebthings-deck.js-e42bd0c/extensions/menu/deck.menu.js"></script>
<script src="imakewebthings-deck.js-e42bd0c/extensions/goto/deck.goto.js"></script>
<script src="imakewebthings-deck.js-e42bd0c/extensions/status/deck.status.js"></script>
<script src="imakewebthings-deck.js-e42bd0c/extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
	$(function() {
		$.deck('.slide');
	});
</script>
</body>
</html>
